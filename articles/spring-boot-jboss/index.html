<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Ilya Murzinov: Running a Spring Boot application on JBoss 7.1.1</title>
        <link rel="icon" type="image/png" href="../../images/favicon.png" />
        <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16" />
        <link rel="stylesheet" type="text/css" href="../../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../../css/syntax.css" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../../">Ilya Murzinov</a>
            </div>
            <div id="navigation">
                <a href="https://github.com/ilya-murzinov"><i class="fab fa-github"></i></a>
                <a href="https://github.com/ilya-murzinov/ilya-murzinov.github.io/tree/hakyll"><i class="fa fa-code"></i></a>
                <a href="https://twitter.com/ilyamurzinov"><i class="fab fa-twitter"></i>
                <a href="https://www.facebook.com/Murzinov.Ilya"><i class="fab fa-facebook"></i>
                <a href="https://www.instagram.com/ilyamurzinov/"><i class="fab fa-instagram"></i>
                <a href="../../talks/">Talks</a>
                <a href="../../about/">About</a>
            </div>
        </div>

        <div id="content">
            <h1>Running a Spring Boot application on JBoss 7.1.1</h1>

<div class="info">
    Posted on March  3, 2015
    
</div>

<h2 id="background">Background</h2>
<!-- TEASER START -->
<p>One of the projects which I was developing used the <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> for configuration, assembling, testing and property managing. Everything was pretty great, we were completely satisfied with Spring Boot and our application ran without any problems on Tomcat 7. But when this project was coming to the end, it turned out that we will have JBoss instead of Tomcat in production. It should not have caused any troubles for us, but we ended up spending lots of time on this migration. And here is one of the reasons why this happened.</p>
<!-- TEASER STOP -->
<p>Of course, I can’t share the source code of our project, so I created a little example that reveals the underlying problem.</p>
<h2 id="the-problem">The problem</h2>
<p>Let’s take a look at a typical Spring Boot web application. Say we have only a controller, a filter and some component which is autowired into the filter (hereinafter imports omitted for brevity):</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@RestController</span>
<span class="kw">public</span> <span class="kw">class</span> HelloController {
    <span class="at">@RequestMapping</span>(<span class="st">&quot;/&quot;</span>)
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">index</span>() {
        <span class="kw">return</span> <span class="st">&quot;Greetings from Spring Boot!&quot;</span>;
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@Component</span>
<span class="kw">public</span> <span class="kw">class</span> HelloComponent {
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">go</span>() {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Inside filter's component&quot;</span>);
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@Component</span>
<span class="kw">public</span> <span class="kw">class</span> HelloFilter <span class="kw">extends</span> GenericFilterBean {
    <span class="at">@Autowired</span>
    <span class="kw">private</span> HelloComponent component;

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">doFilter</span>(ServletRequest servletRequest, ServletResponse servletResponse,
                         FilterChain filterChain) <span class="kw">throws</span> <span class="bu">IOException</span>, ServletException {
        component.<span class="fu">go</span>();
        filterChain.<span class="fu">doFilter</span>(servletRequest, servletResponse);
    }
}</code></pre></div>
<p>The main Application class:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@SpringBootApplication</span>
<span class="kw">public</span> <span class="kw">class</span> Application <span class="kw">extends</span> SpringBootServletInitializer {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        SpringApplication.<span class="fu">run</span>(Application.<span class="fu">class</span>);
    }

    <span class="at">@Override</span>
    <span class="kw">protected</span> SpringApplicationBuilder <span class="fu">configure</span>(SpringApplicationBuilder application) {
        <span class="kw">return</span> application.<span class="fu">sources</span>(Application.<span class="fu">class</span>);
    }
}</code></pre></div>
<p>You can see the entire project <a href="https://github.com/ilya-murzinov/spring-boot-jboss/tree/master/spring-boot-jboss-initial">here</a>.</p>
<p>Ok, let’s build it and run on Tomcat 7:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">mvn</span> clean install
$ <span class="fu">cp</span> ./spring-boot-jboss-initial/target/spring-boot-jboss-initial-1.0-SNAPSHOT.war ~/apache-tomcat-7.0.57/webapps/boot.war
$ <span class="ex">~/apache-tomcat-7.0.57/bin/startup.sh</span></code></pre></div>
<p>And it works just fine:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">curl</span> http://localhost:8080/boot
<span class="ex">Greetings</span> from Spring Boot!</code></pre></div>
<p>Now we deploy it on JBoss-7.1.1 (do not forget to stop Tomcat) and expect it to work fine as well:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="fu">cp</span> ./spring-boot-jboss-initial/target/spring-boot-jboss-initial-1.0-SNAPSHOT.war ~/jboss-7.1.1-Final/standalone/deployments/boot.war
$ <span class="ex">~/jboss-7.1.1-Final/bin/standalone.sh</span></code></pre></div>
<p>But here comes the big problem:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">curl</span> http://localhost:8080/boot
<span class="op">&lt;</span><span class="ex">html</span><span class="op">&gt;&lt;</span>head<span class="op">&gt;&lt;</span>title<span class="op">&gt;</span>JBoss Web/7.0.13.Final - Error report<span class="op">&lt;</span>/title<span class="op">&gt;&lt;</span>/head<span class="op">&gt;</span>
<span class="op">&lt;</span><span class="ex">body</span><span class="op">&gt;&lt;</span>h1<span class="op">&gt;</span>HTTP Status 500 - The server encountered an internal error () <span class="ex">that</span> prevented it from fulfilling this request.
<span class="op">&lt;</span><span class="ex">pre</span><span class="op">&gt;</span>java.lang.NullPointerException
<span class="ex">com.github.ilyamurzinov.springbootjboss.HelloFilter.doFilter</span>(HelloFilter.java:29)
<span class="ex">org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal</span>(CharacterEncodingFilter.java:88)
<span class="ex">org.springframework.web.filter.OncePerRequestFilter.doFilter</span>(OncePerRequestFilter.java:107)
<span class="ex">org.springframework.boot.context.web.ErrorPageFilter.doFilter</span>(ErrorPageFilter.java:108)
<span class="ex">org.springframework.boot.context.web.ErrorPageFilter.access</span><span class="va">$0</span>00(ErrorPageFilter.java:59)
<span class="ex">org.springframework.boot.context.web.ErrorPageFilter</span><span class="va">$1</span>.doFilterInternal(ErrorPageFilter.java:88)
<span class="ex">org.springframework.web.filter.OncePerRequestFilter.doFilter</span>(OncePerRequestFilter.java:107)
<span class="ex">org.springframework.boot.context.web.ErrorPageFilter.doFilter</span>(ErrorPageFilter.java:101)
<span class="op">&lt;</span>/<span class="ex">pre</span><span class="op">&gt;</span>
<span class="op">&lt;</span>/<span class="ex">body</span><span class="op">&gt;&lt;</span>/html<span class="op">&gt;</span></code></pre></div>
<p>What happened?</p>
<h2 id="analysis">Analysis</h2>
<p>Line 29 (== line 9 in the above snippet) of <em>HelloFilter</em> is where <em>HelloComponent</em>’s method <em>go()</em> is called. It’s quite obvious that <em>HelloComponent</em> did not get autowired into the <em>HelloFilter</em> and thus <em>component == null</em>. This kind of situation commonly occures when some Spring’s component gets instantiated not by Spring.</p>
<p>And that’s exactly what happens here. By adding a breakpoint to the <em>HelloComponent</em>’s constructor, we find out that <em>HelloComponent</em> gets instantiated two times: first time by Spring and the second time by JBoss. And when JBoss registers filters it takes <em>HelloComponent</em>’s instance that it created instead of the one created by Spring.</p>
<p>JBoss uses <em>Apache Catalina</em> inside, but a modified version, and it causes all the problems. Let’s take a look at <em>org.apache.catalina.core.StandardContext</em> from <em>org.jboss.web:jbossweb:7.0.13.Final</em>:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">protected</span> <span class="dt">boolean</span> <span class="fu">filterStart</span>() {
        <span class="kw">if</span> (<span class="fu">getLogger</span>().<span class="fu">isDebugEnabled</span>())
            <span class="fu">getLogger</span>().<span class="fu">debug</span>(<span class="st">&quot;Starting filters&quot;</span>);
        <span class="co">// Instantiate and record a FilterConfig for each defined filter</span>
        <span class="dt">boolean</span> ok = <span class="kw">true</span>;
        <span class="bu">Iterator</span>&lt;ApplicationFilterConfig&gt; filterConfigsIterator = 
            filterConfigs.<span class="fu">values</span>().<span class="fu">iterator</span>();
        <span class="kw">while</span> (filterConfigsIterator.<span class="fu">hasNext</span>()) {
            ApplicationFilterConfig filterConfig = filterConfigsIterator.<span class="fu">next</span>();
            <span class="kw">try</span> {
                filterConfig.<span class="fu">getFilter</span>();
            } <span class="kw">catch</span> (<span class="bu">Throwable</span> t) {
                <span class="fu">getLogger</span>().<span class="fu">error</span>
                (sm.<span class="fu">getString</span>(<span class="st">&quot;standardContext.filterStart&quot;</span>, name), t);
                ok = <span class="kw">false</span>;
            }
        }
        <span class="bu">Iterator</span>&lt;<span class="bu">String</span>&gt; names = filterDefs.<span class="fu">keySet</span>().<span class="fu">iterator</span>();
        <span class="kw">while</span> (names.<span class="fu">hasNext</span>()) {
            <span class="bu">String</span> name = names.<span class="fu">next</span>();
            <span class="kw">if</span> (<span class="fu">getLogger</span>().<span class="fu">isDebugEnabled</span>())
                <span class="fu">getLogger</span>().<span class="fu">debug</span>(<span class="st">&quot; Starting filter '&quot;</span> + name + <span class="st">&quot;'&quot;</span>);
            ApplicationFilterConfig filterConfig = <span class="kw">null</span>;
            <span class="kw">try</span> {
                filterConfig = <span class="kw">new</span> ApplicationFilterConfig
                (<span class="kw">this</span>, (FilterDef) filterDefs.<span class="fu">get</span>(name));
                filterConfig.<span class="fu">getFilter</span>();
                filterConfigs.<span class="fu">put</span>(name, filterConfig);
            } <span class="kw">catch</span> (<span class="bu">Throwable</span> t) {
                <span class="fu">getLogger</span>().<span class="fu">error</span>
                (sm.<span class="fu">getString</span>(<span class="st">&quot;standardContext.filterStart&quot;</span>, name), t);
                ok = <span class="kw">false</span>;
            }
        }
        <span class="kw">return</span> (ok);
    }</code></pre></div>
<p>This class has two fields - <em>filterConfigs</em> and <em>filterDefs</em>, by the time it enters this method, the <em>filterConfigs</em> contains filters created by Spring, and the <em>filterDefs</em> contains only names and class names of those filters. The first loop, starting at line 8 gets correct filters from <em>filterConfigs</em> and registers them. But then the second loop, starting at line 19 instantiates filters again and then registers them with the same filterNames. Thus, correct filters get overwritten.</p>
<h2 id="solution">Solution</h2>
<p>The idea is to disable the filter after Spring has created it (so JBoss wouldn’t register it) and then create a proxy that delegate calls to the filter taken from Spring context. I used <em>FilterRegistrationBean</em> and <em>BeanPostProcessor</em> to disable the filter.</p>
<div class="sourceCode"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;<span class="kw">?&gt;</span>
<span class="kw">&lt;beans</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.springframework.org/schema/beans&quot;</span>
<span class="ot">       xmlns:xsi=</span><span class="st">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="ot">       xsi:schemaLocation=</span><span class="st">&quot;http://www.springframework.org/schema/beans</span>
<span class="st">	http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;bean</span><span class="ot"> id=</span><span class="st">&quot;helloFilter&quot;</span> 
<span class="ot">          class=</span><span class="st">&quot;com.github.ilyamurzinov.springbootjboss.HelloFilter&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;bean</span><span class="ot"> id=</span><span class="st">&quot;helloFilterRegistrationBean&quot;</span> 
<span class="ot">	  class=</span><span class="st">&quot;org.springframework.boot.context.embedded.FilterRegistrationBean&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;property</span><span class="ot"> name=</span><span class="st">&quot;filter&quot;</span><span class="ot"> ref=</span><span class="st">&quot;helloFilter&quot;</span><span class="kw">/&gt;</span>
        <span class="kw">&lt;property</span><span class="ot"> name=</span><span class="st">&quot;enabled&quot;</span><span class="ot"> value=</span><span class="st">&quot;true&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;/bean&gt;</span>
<span class="kw">&lt;/beans&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@Component</span>
<span class="kw">public</span> <span class="kw">class</span> JBossProxyInitializer <span class="kw">implements</span> BeanFactoryPostProcessor {

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">postProcessBeanFactory</span>(ConfigurableListableBeanFactory beanFactory) <span class="kw">throws</span> BeansException {
        <span class="co">// Disabling filters created by Spring so JBoss wouldn't register them as well</span>
        <span class="kw">for</span> (<span class="bu">String</span> name : beanFactory.<span class="fu">getBeanDefinitionNames</span>()) {
            <span class="kw">if</span> (!name.<span class="fu">contains</span>(<span class="st">&quot;FilterRegistrationBean&quot;</span>)) {
                <span class="kw">continue</span>;
            }
            BeanDefinition definition = beanFactory.<span class="fu">getBeanDefinition</span>(name);
            definition.<span class="fu">getPropertyValues</span>().<span class="fu">add</span>(<span class="st">&quot;enabled&quot;</span>, <span class="kw">false</span>);
        }

        FilterRegistrationBean filterRegistrationBean = <span class="kw">new</span> <span class="fu">FilterRegistrationBean</span>();
        filterRegistrationBean.<span class="fu">setFilter</span>(<span class="kw">new</span> Application.<span class="fu">HelloFilterProxy</span>());
        filterRegistrationBean.<span class="fu">setUrlPatterns</span>(<span class="bu">Collections</span>.<span class="fu">singletonList</span>(<span class="st">&quot;/*&quot;</span>));

        beanFactory.<span class="fu">registerSingleton</span>(<span class="st">&quot;helloFilterProxyFilterRegistrationBean&quot;</span>, filterRegistrationBean);
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@SpringBootApplication</span>
<span class="at">@ImportResource</span>(<span class="st">&quot;classpath:context.xml&quot;</span>)
<span class="kw">public</span> <span class="kw">class</span> Application <span class="kw">extends</span> SpringBootServletInitializer {

    <span class="kw">private</span> <span class="kw">volatile</span> <span class="dt">static</span> WebApplicationContext webApplicationContext;

    <span class="at">@Override</span>
    <span class="kw">protected</span> WebApplicationContext <span class="fu">createRootApplicationContext</span>(ServletContext servletContext) {
        webApplicationContext = <span class="kw">super</span>.<span class="fu">createRootApplicationContext</span>(servletContext);
        <span class="kw">return</span> webApplicationContext;
    }

    <span class="at">@Override</span>
    <span class="kw">protected</span> SpringApplicationBuilder <span class="fu">configure</span>(SpringApplicationBuilder builder) {
        <span class="kw">return</span> builder.<span class="fu">sources</span>(Application.<span class="fu">class</span>, JBossProxyInitializer.<span class="fu">class</span>);
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        SpringApplication.<span class="fu">run</span>(Application.<span class="fu">class</span>);
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="kw">class</span> HelloFilterProxy <span class="kw">extends</span> DelegatingFilterProxy {
        <span class="at">@Override</span>
        <span class="kw">protected</span> <span class="bu">Filter</span> <span class="fu">initDelegate</span>(WebApplicationContext wac) <span class="kw">throws</span> ServletException {
            <span class="kw">return</span> Application.<span class="fu">webApplicationContext</span>.<span class="fu">getBean</span>(HelloFilter.<span class="fu">class</span>);
        }
    }</code></pre></div>
<p>If you need to use more filters you should use (if not using already) <em>org.springframework.web.filter.CompositeFilter</em>.</p>
<p>Now we have our filter instantiated and registered correctly, let’s test it:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">curl</span> http://localhost:8080/boot
<span class="op">&lt;</span><span class="ex">html</span><span class="op">&gt;&lt;</span>head<span class="op">&gt;&lt;</span>title<span class="op">&gt;</span>JBoss Web/7.0.13.Final - Error report<span class="op">&lt;</span>/title<span class="op">&gt;</span>
<span class="op">&lt;</span>/<span class="ex">head</span><span class="op">&gt;&lt;</span>body<span class="op">&gt;&lt;</span>h1<span class="op">&gt;</span>HTTP Status 404 - /boot/<span class="op">&lt;</span>/h1<span class="op">&gt;</span>
<span class="op">&lt;</span><span class="ex">p</span><span class="op">&gt;&lt;</span>b<span class="op">&gt;</span>type<span class="op">&lt;</span>/b<span class="op">&gt;</span> Status report<span class="op">&lt;</span>/p<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span>
<span class="op">&lt;</span><span class="ex">b</span><span class="op">&gt;</span>message<span class="op">&lt;</span>/b<span class="op">&gt;</span> <span class="op">&lt;</span>u<span class="op">&gt;</span>/boot/<span class="op">&lt;</span>/u<span class="op">&gt;&lt;</span>/p<span class="op">&gt;&lt;</span>p<span class="op">&gt;&lt;</span>b<span class="op">&gt;</span>description<span class="op">&lt;</span>/b<span class="op">&gt;</span> 
<span class="op">&lt;</span><span class="ex">u</span><span class="op">&gt;</span>The requested resource (/boot/) <span class="ex">is</span> not available.<span class="op">&lt;</span>/u<span class="op">&gt;&lt;</span>/p<span class="op">&gt;</span>
<span class="op">&lt;</span><span class="ex">h3</span><span class="op">&gt;</span>JBoss Web/7.0.13.Final<span class="op">&lt;</span>/h3<span class="op">&gt;&lt;</span>/body<span class="op">&gt;&lt;</span>/html<span class="op">&gt;</span></code></pre></div>
<p>That’s definitely better than NPE, but still not what we expected. Why did that happen?</p>
<p>Appears that JBoss treats servlets just like filters and thus Spring’s <em>DispatcherServlet</em> does not get instantiated properly. So we need to add a proxy for this servlet to <em>JBossProxyInitializer</em> as well:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@SpringBootApplication</span>
<span class="at">@ImportResource</span>(<span class="st">&quot;classpath:context.xml&quot;</span>)
<span class="kw">public</span> <span class="kw">class</span> Application <span class="kw">extends</span> SpringBootServletInitializer {
    <span class="co">/* ... */</span>

    <span class="kw">public</span> <span class="dt">static</span> <span class="kw">class</span> DispatcherServletProxy <span class="kw">implements</span> Servlet {

        <span class="kw">private</span> Servlet delegate;

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span>(ServletConfig config) <span class="kw">throws</span> ServletException {
            delegate = Application.<span class="fu">webApplicationContext</span>.<span class="fu">getBean</span>(DispatcherServlet.<span class="fu">class</span>);
            delegate.<span class="fu">init</span>(config);
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> ServletConfig <span class="fu">getServletConfig</span>() {
            <span class="kw">return</span> delegate.<span class="fu">getServletConfig</span>();
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">service</span>(ServletRequest req, ServletResponse res) <span class="kw">throws</span> ServletException, <span class="bu">IOException</span> {
            delegate.<span class="fu">service</span>(req, res);
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getServletInfo</span>() {
            <span class="kw">return</span> delegate.<span class="fu">getServletInfo</span>();
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">destroy</span>() {
            delegate.<span class="fu">destroy</span>();
        }
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@Component</span>
<span class="kw">public</span> <span class="kw">class</span> JBossProxyInitializer <span class="kw">implements</span> BeanFactoryPostProcessor {

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">postProcessBeanFactory</span>(ConfigurableListableBeanFactory beanFactory) <span class="kw">throws</span> BeansException {
        <span class="co">/* ... */</span>

        ServletRegistrationBean servletRegistrationBean = <span class="kw">new</span> <span class="fu">ServletRegistrationBean</span>();
        servletRegistrationBean.<span class="fu">setServlet</span>(<span class="kw">new</span> Application.<span class="fu">DispatcherServletProxy</span>());
        servletRegistrationBean.<span class="fu">setUrlMappings</span>(<span class="bu">Collections</span>.<span class="fu">singletonList</span>(<span class="st">&quot;/*&quot;</span>));

        beanFactory.<span class="fu">registerSingleton</span>(<span class="st">&quot;dispatcherServletProxyRegistrationBean&quot;</span>, servletRegistrationBean);
    }
}</code></pre></div>
<p>And finally:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="fu">cp</span> ./spring-boot-jboss-final/target/spring-boot-jboss-final-1.0-SNAPSHOT.war ~/jboss-7.1.1-Final/standalone/deployments/boot.war
$ <span class="ex">~/jboss-7.1.1-Final/bin/standalone.sh</span>
$ <span class="ex">curl</span> http://localhost:8080/boot
<span class="ex">Greetings</span> from Spring Boot!</code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>Although, the strange JBoss’s behaviour still remains a mystery to me, the workaround described above lets an application run normally on this application server. The only drawback of this solution (except it being an ugly hack :) ) is that it doesn’t scale when it comes to servlets. This means that you <em>have</em> to create a proxy for every servlet in your application.</p>
<p>Any questions are welcome in comments.</p>

<div id="disqus_thread"></div>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ilyamurzinovgithubio'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="../../web/20160303120853/http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="../../web/20160303120853/http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
        <div id="footer">
            Powered by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
    <!-- Asynchronous Google Analytics snippet -->
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-60047092-1', 'auto');
     ga('send', 'pageview');

    </script>

</html>
